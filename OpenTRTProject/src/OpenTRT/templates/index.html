<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenTRT Local</title>
    <style>
      /* Upload button */
      .file-input-label {
        display: block;
        padding: 10px 15px;
        font-size: 18px;
        font-weight: bold;
        color: #fff;
        background-color: #3498db;
        border: 1px solid #3498db;
        border-radius: 5px;
        cursor: pointer;
      }

      #myFile {
        display: none;
      }

      #selectedFileName {
        margin-top: 10px;
        font-size: 18px;
        color: #333;
      }
    </style>
  </head>
  <body
    style="display: flex; justify-content: center; height: 100vh; width: 100vw"
  >
    <div>
      <h1 style="text-align: center">OpenTRT: Safe PDF redaction</h1>
      <!-- {% if file %}
      <h1>Hello {{ file }}!</h1>
      {% else %}
      <h1>Please select a file...</h1>
      {% endif %} -->

      <div
        style="
          display: flex;
          justify-content: center;
          align-items: center;
          width: 100vw;
        "
      >
        <form
          style="display: flex; justify-content: center"
          method="post"
          action="{{ url_for('run_function') }}"
        >
          <div>
            <div
              style="
                display: flex;
                justify-content: center;
                justify-items: center;
              "
            >
              <label for="myFile" class="file-input-label">Choose File</label>
              <div style="margin-left: 2rem">
                <input
                  type="file"
                  id="myFile"
                  name="filename"
                  action="{{ url_for('upload_file') }}"
                />
                <p id="selectedFileName">No file selected</p>
              </div>
            </div>
            <div
              style="
                display: flex;
                align-items: center;
                margin-top: 1rem;
                justify-content: center;
              "
            >
              <input
                type="checkbox"
                id="replacementOption"
                name="replacementOption"
                style="margin-right: 8px"
              />

              <label
                for="replacementOption"
                style="font-size: 16px; color: #333"
                >Replacement value?</label
              >
            </div>
            <div style="display: flex; justify-content: center">
              <button style="display: block; margin-top: 1rem" type="submit">
                Run Function
              </button>
            </div>
          </div>
        </form>
      </div>

      <div style="display: flex; justify-content: center">
        {% if message %}
        <p>{{ message }}</p>
        {% endif %}
      </div>
    </div>

    <script>
      document.getElementById("myFile").addEventListener("change", function () {
        var selectedFileName = document.getElementById("selectedFileName");
        selectedFileName.textContent =
          this.files.length > 0 ? this.files[0].name : "No file selected";
        uploadFile();
      });

      function uploadFile() {
        var fileInput = document.getElementById("myFile");
        var file = fileInput.files[0];

        if (!file) {
          document.getElementById("selectedFileName").innerText =
            "No file selected";
          return;
        }

        var formData = new FormData();
        formData.append("file", file);

        fetch("/", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.error) {
              document.getElementById("selectedFileName").innerText =
                data.error;
            } else {
              document.getElementById("selectedFileName").innerText =
                data.success;
            }
          })
          .catch((error) => {
            console.error("Error:", error);
          });
      }
    </script>
  </body>
</html>
